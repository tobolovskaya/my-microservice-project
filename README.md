# lesson-5: Terraform Infrastructure on AWS

## Структура проекту

```
lesson-5/
│
├── main.tf     <- Головний файл для підключення модулів
├── backend.tf  <- Налаштування бекенду для стейтів (S3 + DynamoDB)
├── outputs.tf  <- Загальне виведення ресурсів
│
├── modules/    <- Каталог з усіма модулями
│ │
│ ├── s3-backend/    <- Модуль для S3 та DynamoDB
│ │ ├── s3.tf        <- Створення S3-бакета
│ │ ├── dynamodb.tf  <- Створення DynamoDB
│ │ ├── variables.tf <- Змінні для S3
│ │ └── outputs.tf   <- Виведення інформації про S3 та DynamoDB
│ │
│ ├── vpc/           <- Модуль для VPC
│ │ ├── vpc.tf       <- Створення VPC, підмереж, Internet Gateway, NAT Gateway
│ │ ├── routes.tf    <- Налаштування маршрутизації
│ │ ├── variables.tf <- Змінні для VPC
│ │ └── outputs.tf   <- Виведення інформації про VPC
│ │
│ └── ecr/          <- Модуль для ECR
│ ├── ecr.tf        <- Створення ECR репозиторію
│ ├── variables.tf  <- Змінні для ECR
│ └── outputs.tf    <- Виведення URL репозиторію ECR
│
└── README.md   <- Документація проєкту
```

## Terraform-команди

1. Ініціалізація Terraform (завантаження модулів, підключення до бекенду)

```
terraform init
```

2. Перевірка та попередній перегляд змін в інфраструктурі

```
terraform plan
```

3. Застосування змін, створення ресурсів

```
terraform apply
```

4. Видалення всіх створених ресурсів

```
terraform destroy
```

## Огляд модулів

### Модуль `s3-backend/`

Цей модуль створює інфраструктуру для збереження **стану Terraform (tfstate)**:

- `aws_s3_bucket` - бакет з увімкненим версіюванням та шифруванням.
- `aws_dynamodb_table` - таблиця для **lock-файлів**, яка запобігає одночасному оновленню стану.

Використовується в `backend.tf` для зберігання стану інфраструктури.

### Модуль `vpc/`

Цей модуль створює базову мережеву інфраструктуру:

- `aws_vpc` - основна мережа з зазначеним CIDR-блоком.
- `aws_subnet` - 3 публічні та 3 приватні підмережі у різних зонах доступності.
- `aws_internet_gateway` - дає доступ в інтернет публічним підмережам.
- `aws_nat_gateway` - дозволяє вихід в інтернет для приватних підмереж.
- `aws_route_table`, `aws_route`, `aws_route_table_association` - для маршрутизації трафіку.

### Модуль `ecr/`

Модуль створює **ECR-репозиторій**, у якому можна зберігати Docker-образи:

- `aws_ecr_repository` - з опціональним `image_scanning_configuration` (наприклад, `scan_on_push = true`)
- `aws_ecr_repository_policy` - дозволяє EC2 (або іншим сервісам) тягнути образи (pull policy).

Політика за замовчуванням дозволяє сервісу `ec2.amazonaws.com` витягувати образи з ECR.
